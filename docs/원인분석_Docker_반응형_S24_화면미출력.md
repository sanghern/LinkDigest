# Docker 프론트엔드 반응형 웹 – 모바일(S24 등) 로그인/흰 화면 미출력 원인 분석

## 현상 정리

| 실행 환경 | 갤럭시 S26 Ultra | 갤럭시 S24 |
|-----------|------------------|------------|
| **npm start** (개발 서버) | ✅ 로그인·메인 UI 정상 | ✅ 로그인·메인 UI 정상 |
| **Docker** (프론트 빌드 + Nginx) | ✅ 정상 | ❌ 로그인 화면 안 보임 |

- npm start 시에는 두 기기 모두 정상 → **코드/라우팅 자체는 동일**.
- Docker 시 S24에서만 실패 → **Docker 빌드·서빙 환경 또는 기기/브라우저 조합**에서만 발생하는 이슈로 보는 것이 타당함.

---

## 가능 원인 (우선순위)

### 1. **index.html / JS 청크 캐시 (가능성 높음)**

- **구성**: Docker는 `npm run build` 결과를 Nginx로 서빙. 빌드 시 JS/CSS는 해시된 파일명(예: `main.abc123.js`)으로 생성됨.
- **동작**: Nginx에서 `location ~* \.(js|css|...)$` 로 **1년 캐시**(`expires 1y`, `immutable`)를 적용하고 있음. 반면 **index.html**에는 별도 Cache-Control을 두지 않아, 브라우저 기본 캐시 정책에 따름.
- **시나리오**:
  - S24에서 **예전에** 같은 도메인 접속 → 이전 배포본의 **index.html**이 캐시됨.
  - 서버는 **새로 배포**되어 index.html과 청크 파일명이 바뀜.
  - S24가 **캐시된 옛 index.html**을 사용 → 옛 index가 참조하는 **옛 청크 파일**을 요청 → 서버에는 없음(404) → JS 미로드 → **흰 화면**.
- S26 Ultra는 같은 사이트를 캐시하지 않았거나, 캐시를 쓰지 않아 새 index.html을 받아서 정상 동작할 수 있음.

**대응**:  
- **index.html(HTML 문서)은 캐시하지 않거나 짧은 캐시**로 두고,  
- JS/CSS 등 해시된 정적 자원만 장기 캐시 유지.  
→ Nginx에서 HTML에 대해 `Cache-Control: no-cache` 또는 `max-age=0` 적용 권장.

---

### 2. **JS 실행 오류 (특정 기기/브라우저)**

- **가능성**: Docker 빌드는 **production** 번들(압축·최적화)이라, 특정 브라우저/WebView 버전에서만 발생하는 문법·API 호환 문제가 있을 수 있음.
- **상황**: S24 기본 브라우저(삼성 인터넷) 또는 WebView 버전이 S26 Ultra와 다를 수 있음. 같은 Chrome이라도 기기별로 WebView/엔진 버전이 다를 수 있음.
- **증상**: 스크립트 로드 직후 에러 → React 미마운트 → 흰 화면(로그인 화면이 “안 보임”).

**대응**:
- S24에서 **Chrome**으로 직접 접속해 보기(삼성 인터넷 대신).
- S24에서 **원격 디버깅**(Chrome DevTools over USB) 또는 **에러 로그 수집**으로 콘솔 에러 확인.
- `package.json`의 **browserslist**가 너무 최신만 타깃하지 않도록 유지 (현재 `">0.2%", "not dead"` 수준이면 무난).

---

### 3. **네트워크/리소스 로드 실패**

- **가능성**: S24에서만 특정 JS/CSS 청크 요청이 실패(타임아웃, 차단, 프록시 등).
- **증상**: 404/네트워크 에러로 일부 스크립트 미로드 → 흰 화면.

**대응**:
- S24에서 브라우저 개발자 도구 네트워크 탭으로 **실패한 요청(빨간 줄)** 확인.
- 같은 Wi‑Fi/동일 네트워크에서 S26 Ultra와 S24 비교.

---

### 4. **SPA 라우팅과 Nginx**

- **현재**: Nginx에 `try_files $uri $uri/ /index.html;` 설정 있음 → `/login` 등 직접 접근 시에도 index.html 제공.
- **판단**: S26 Ultra에서 Docker로 정상이라면, Nginx 라우팅 자체는 문제 가능성 낮음. 다만 S24에서 **특정 경로만** 접속해 본다면, 그 경로에 대한 Nginx/캐시 동작은 한 번 더 확인할 가치 있음.

---

## 권장 조치 (즉시 적용 가능)

1. **Nginx에서 HTML 문서 캐시 제한** ✅ 적용함  
   - `frontend/docker/nginx.conf`의 `location /` 에  
     `add_header Cache-Control "max-age=0, must-revalidate";` 사용 (프록시와 충돌 방지 위해 `no-store` 미사용).  
   - 해시된 `.js`, `.css` 등은 기존처럼 장기 캐시 유지.  
   - 재배포 후 Docker 이미지를 다시 빌드(`docker compose build`)해야 반영됨.

**모바일 흰 화면 추가 대응 (PC는 정상, S26·S24 흰 화면):**
- **index.html**: `#root` 안에 "로딩 중..." 폴백 + `window.onerror` / `unhandledrejection` 시 에러 문구 표시. JS 오류 시 원인 확인 가능.
- **nginx**: `Vary: User-Agent` 추가로 PC/모바일 응답 캐시 분리.
- 모바일에서 여전히 흰 화면이면 "로딩 중..." 또는 빨간색 "오류: ..." 문구가 보이면, 해당 메시지로 원인 추적 가능.

2. **S24에서 캐시/데이터 삭제 후 재접속**  
   - 해당 사이트 **사이트 설정 → 저장된 데이터 삭제** (또는 브라우저 전체 캐시 삭제) 후 다시 접속해 보기.

3. **S24에서 원인 수집**  
   - Chrome 연결 후 **원격 디버깅**으로 콘솔 에러·네트워크 실패 여부 확인.  
   - 가능하면 **빈 화면이 나올 때의 URL**과 **사용 브라우저(Chrome / 삼성 인터넷)** 기록.

---

## 요약

- **npm start는 둘 다 정상**이므로, **반응형/로그인 UI 코드 자체**보다는 **Docker 빌드·서빙 환경**과 **기기별 캐시/브라우저 차이**가 원인일 가능성이 큼.
- **우선 적용**: index.html(및 HTML 응답) 캐시 제한 + S24 캐시 삭제 후 재현 여부 확인.
- **추가 확인**: S24 브라우저 콘솔/네트워크 로그로 JS 오류·리소스 로드 실패 여부 확인.
