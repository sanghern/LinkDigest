# 작업 TDL (To-Do List) – 나중에 구현할 항목

이 문서는 **추후 구현할 기능**의 요구사항·필요 사항·작업 절차를 정리한 참조용 문서입니다.  
해당 기능 작업 시 이 문서를 참고해 진행하면 됩니다.

---

## 나중에 구현할 공유 기능 (Slack / Notion)

### 1. 현재 상태 요약

| 구분 | 상태 | 비고 |
|------|------|------|
| **백엔드** | | |
| 공유 API | ✅ 완료 | `POST /api/bookmarks/{bookmark_id}/share`, Body: `{ "target": "slack" \| "notion" }` |
| 인증·권한 | ✅ 완료 | 로그인 사용자, 본인 북마크만 공유 가능 |
| 성공 응답 | ✅ 완료 | `{ "success": true, "title": "공유한 북마크 제목" }` |
| `share_service.py` | ⏳ 인터페이스만 | `share_to_slack(bookmark)`, `share_to_notion(bookmark)` 스텁, 제목만 반환 |
| **프론트엔드** | | |
| 공유 버튼 | ✅ 완료 | `BookmarkDetail` 상단, 뒤로가기 버튼 오른쪽, 동일 크기·다른 색 |
| 공유 모달 | ✅ 완료 | Slack / Notion 선택 후 API 호출 |
| 성공 팝업 | ✅ 완료 | 백엔드에서 받은 "제목" 표시, 확인 시 닫기 (URL 중복 팝업과 동일 스타일) |
| 실패 표시 | ✅ 완료 | 공유 모달 내 에러 메시지 표시 |

**나중에 할 일**: `share_to_slack`, `share_to_notion`의 **실제 전송 로직**만 구현하면 됨.

---

### 2. 구현에 필요한 사항

#### 2.1 Slack 연동

| 항목 | 내용 |
|------|------|
| **수정 파일** | `backend/app/services/share_service.py` → `share_to_slack(bookmark)` 내부 |
| **방식** | Slack Incoming Webhook URL **또는** Slack Web API(Bot Token) |
| **환경 변수** | `SLACK_WEBHOOK_URL` (Webhook 사용 시) **또는** `SLACK_BOT_TOKEN` (Web API 사용 시). `.env`에 추가, `.gitignore`로 비공개 유지. |
| **전송할 데이터** | 북마크 **제목**, **URL**, **요약( summary )** 텍스트. (선택: 채널 ID 등은 추후 확장 시 body/쿼리로 받을 수 있음.) |
| **에러 처리** | Slack API/Webhook 실패 시 예외 발생 → 엔드포인트에서 500 및 메시지 반환, 프론트는 이미 에러 메시지 표시 중. |

**참고**: Webhook은 단순 POST로 메시지 전송. Web API는 채널 목록·채널 선택 등 확장 시 유리.

#### 2.2 Notion 연동

| 항목 | 내용 |
|------|------|
| **수정 파일** | `backend/app/services/share_service.py` → `share_to_notion(bookmark)` 내부 |
| **방식** | Notion Integration Token + 데이터베이스 또는 페이지에 블록/페이지 생성 |
| **환경 변수** | `NOTION_TOKEN`(Integration Secret), `NOTION_DATABASE_ID` 또는 `NOTION_PAGE_ID`. `.env`에 추가. |
| **전송할 데이터** | 북마크 **제목**, **URL**, **요약**을 Notion 블록(paragraph, heading, link 등) 또는 자식 페이지로 생성. |
| **에러 처리** | Notion API 실패 시 예외 발생 → 동일하게 500 및 메시지 반환. |

**참고**: Notion API는 블록 단위 생성 또는 데이터베이스 항목 생성 등 문서 참고 필요.

#### 2.3 공통

- **설정 문서**: Slack Webhook 생성 방법, Notion Integration 토큰 발급 방법을 `docs/`에 간단히 정리해 두면 운영 시 유리.
- **시크릿**: API 키·Webhook URL은 **서버(백엔드)에만** 두고, 클라이언트는 `/api/bookmarks/{id}/share` 만 호출.

---

### 3. 구현 절차 (참조용)

작업 시 아래 순서를 참고하면 됩니다.

1. **Slack 먼저 (권장)**  
   - Slack Workspace에서 Incoming Webhook 추가 또는 Bot 생성 후 Webhook URL / Bot Token 확보.  
   - `backend/.env`에 `SLACK_WEBHOOK_URL`(또는 `SLACK_BOT_TOKEN`) 추가.  
   - `share_service.py`의 `share_to_slack(bookmark)` 안에서:
     - `bookmark.title`, `bookmark.url`, `bookmark.summary`로 메시지 구성.
     - `requests.post(webhook_url, json=payload)` 또는 Slack Web API 호출.
     - 성공 시 `return bookmark.title or ""` 유지, 실패 시 예외 raise.
   - 공유 버튼 → Slack 선택 → 이미 연동된 API 호출로 동작 확인.

2. **Notion 추가**  
   - Notion에서 Integration 생성 후 Token, 연동할 Database 또는 Page ID 확보.  
   - `backend/.env`에 `NOTION_TOKEN`, `NOTION_DATABASE_ID`(또는 `NOTION_PAGE_ID`) 추가.  
   - `share_service.py`의 `share_to_notion(bookmark)` 안에서:
     - Notion API로 블록 또는 페이지 생성(제목, URL, 요약 반영).
     - 성공 시 `return bookmark.title or ""`, 실패 시 예외 raise.
   - 공유 버튼 → Notion 선택 후 동작 확인.

3. **문서·환경 정리**  
   - `docs/`에 Slack/Notion 연동 설정 방법(Webhook 생성, Notion 토큰 발급) 요약.  
   - 배포 시 필요한 환경 변수 목록을 README 또는 운영 문서에 반영.

---

### 4. 관련 코드 위치

| 목적 | 위치 |
|------|------|
| 공유 API 엔드포인트 | `backend/app/api/endpoints/bookmarks.py` → `share_bookmark` |
| 공유 요청/응답 스키마 | `backend/app/schemas/bookmark.py` → `ShareRequest`, `ShareResponse` |
| **Slack/Notion 실제 구현** | `backend/app/services/share_service.py` → `share_to_slack`, `share_to_notion` |
| 프론트 공유 버튼·모달·성공 팝업 | `frontend/src/components/BookmarkDetail.js` |
| 프론트 API 호출 | `frontend/src/utils/api.js` → `bookmarks.share(bookmarkId, target)` |

---

### 5. 참고 문서

- **북마크 공유 기능 전체 절차·UI 요약**: [북마크_공유_기능_작업절차.md](./북마크_공유_기능_작업절차.md)
- **백엔드 API·환경 변수**: [../backend/backend.md](../backend/backend.md)

---

### 6. 기타 구현 완료 (참고)

| 항목 | 설명 |
|------|------|
| **요약 모델 선택** | `.env`의 `OLLAMA_MODEL_LISTS`, `GET /api/bookmarks/summary-models`, 북마크 생성 시 `summary_model`(선택). 프론트 AddBookmark에 모델 드롭다운 연동. |
| **URL 중복 체크 on/off** | `.env`의 `DUPLICATE_URL_CHECK_ENABLED=True\|False`. |
| **요약 프롬프트 외부화** | `backend/app/utils/prompt.conf` (JSON). `system`, `user_template` 배열로 정의. |

---

*이 문서는 공유 기능의 “나중에 구현할 부분”을 작업할 때 참조하기 위한 TDL입니다. 구현이 완료되면 해당 항목을 완료 처리하거나 이 문서를 갱신하면 됩니다.*
